(function(){if(!Prototype){return }var A=function(){var B=0;return function(){return B++}}();window.Ajax_upload=Class.create({initialize:function(C,B){if(typeof C=="string"){C=$$(C);if(C.length!=1){return }C=C[0]}this.button=C;this.wrapper=null;this.form=null;this.input=null;this.iframe=null;this.disabled=false;this.submitting=false;this.settings=$H({action:"upload.php",name:"userfile",data:{},onSubmit:function(D,E){},onComplete:function(E,D){}}).update(B);this.create_wrapper();this.create_input();this.create_iframe()},set_data:function(B){this.settings.set("data",B)},disable:function(){this.disabled=true;if(!this.submitting){this.input.writeAttribute("disabled",true);this.button.removeClassName("hover")}},enable:function(){this.disabled=false;this.input.writeAttribute("disabled",false)},create_wrapper:function(){var C=this.button,D;D=this.wrapper=new Element("div");C.insert({after:D});D.insert(C);setTimeout(function(){var E=C.getDimensions();D.setStyle({position:"relative",display:"block",overflow:"hidden",height:E.height,width:E.width})},1);var B=this;D.observe("mousemove",function(E){if(!B.input){return }B.input.setStyle({top:E.pageY-D.cumulativeOffset().top-5+"px",left:E.pageX-D.cumulativeOffset().left-170+"px"})})},create_input:function(){var B=this;this.input=new Element("input",{type:"file",name:this.settings.get("name")});this.input.setStyle({position:"absolute",margin:0,padding:0,width:"220px",height:"10px",opacity:0,cursor:"pointer"});this.wrapper.insert(this.input);this.input.observe("change",function(){if(B.input.value==""){return }B.submitting=true;B.submit();if(B.disabled){B.disable()}B.submitting=false;B.input.value=""});this.input.observe("mouseover",function(){B.button.addClassName("hover")});this.input.observe("mouseout",function(){B.button.removeClassName("hover")});if(this.disabled){this.input.writeAttribute("disabled","disabled")}},create_iframe:function(){var B="valumsl8mh6sdc_"+A();this.iframe=new Element("iframe",{id:B,name:B});this.iframe.setStyle({display:"none"});$(document.body).insert(this.iframe)},submit:function(){var B=this,E=this.settings;var C=this.file_from_path(this.input.value);if(E.get("onSubmit").call(this,C,this.get_ext(C))===false){return }this.create_form();this.form.insert(this.input);this.form.submit();this.input.remove();this.input=null;this.form.remove();this.form=null;this.submitting=false;this.create_input();var D=this.iframe;D.observe("load",function(){if(!D||D.src=="about:blank"){return }var G=D.contentDocument?D.contentDocument:frames[D.id].document;var F=G.body.innerHTML;E.get("onComplete").call(B,C,F);setTimeout(function(){D.src="about:blank";D.remove();D=null},1)});this.create_iframe()},create_form:function(){var B="valumsl86jtegr"+A();var D='<form id="'+B+'" method="post" enctype="multipart/form-data"></form>';$(document.body).insert(D);this.form=$(B);this.form.writeAttribute({action:this.settings.get("action"),target:this.iframe.name});for(var C in this.settings.get("data")){this.form.insert(new Element("input",{type:"hidden",name:C,value:this.settings.get("data")[C]}))}},file_from_path:function(B){return B.replace(/.*(\/|\\)/,"")},get_ext:function(B){return(/[.]/.exec(B))?/[^.]+$/.exec(B.toLowerCase()):""},make_parent_opaque:function(){return ;this.button.add(this.button.parents()).each(function(){var B=$(this).css("backgroundColor");var C=$(this).css("backgroundImage");if(B!="transparent"||C!="none"){$(this).css("opacity",1);return false}})}})})();